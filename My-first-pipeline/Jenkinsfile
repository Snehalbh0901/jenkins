pipeline {
    agent any

    environment {
        EC2_HOST = 'ec2-user@3.80.194.17'
    }

    stages {
        stage('Check Jenkins on EC2') {
            steps {
                // Correct way to use SSH credentials in a pipeline
                withCredentials([sshUserPrivateKey(credentialsId: '3.80.194.17', keyFileVariable: 'SSH_KEY_FILE')]) {
                    script {
                        echo "üîç Checking if Jenkins is installed on ${EC2_HOST}..."

                        def result = sh(
                            script: """
                                ssh -o StrictHostKeyChecking=no -i "$SSH_KEY_FILE" $EC2_HOST 'which jenkins || which java && systemctl status jenkins'
                            """,
                            returnStatus: true
                        )

                        if (result == 0) {
                            echo "‚úÖ Jenkins is installed and/or running on EC2."
                        } else {
                            echo "‚ùå Jenkins is NOT installed or NOT running on EC2."
                        }
                    }
                }
            }
        }
    }
}
